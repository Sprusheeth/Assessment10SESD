<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ShopClone â€” Amazon-style Client-Server Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --brand:#FF9900;
  --nav:#131921;
  --muted:#6b6b6b;
  --bg:#eaeded;
  --card:#fff;
  --accent:#232F3E;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:#111}
a{color:inherit}
header.navbar{
  background:var(--nav);color:#fff;padding:10px 16px;display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:50;
  box-shadow:0 2px 6px rgba(0,0,0,0.12)
}
.logo{display:flex;align-items:center;gap:8px;font-weight:800;font-size:20px;text-decoration:none}
.logo .box{background:var(--brand);color:#111;padding:6px 8px;border-radius:4px;font-weight:900}
.search{
  flex:1;display:flex;align-items:center;background:#fff;border-radius:6px;overflow:hidden;height:40px
}
.search input{flex:1;padding:10px;border:0;outline:none;font-size:14px}
.search button{background:#f3a200;border:0;padding:10px 14px;cursor:pointer;font-weight:700}
.navlinks{display:flex;gap:14px;align-items:center}
.navlinks .item{padding:8px 10px;border-radius:6px;cursor:pointer}
.container{max-width:1200px;margin:18px auto;padding:0 16px}
.topbar{display:flex;justify-content:space-between;gap:12px;align-items:center;margin-bottom:14px}
.hero{display:flex;gap:12px;align-items:center}
.hero .banner{flex:1;background:linear-gradient(180deg,#fff,#f7f7f7);padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
.layout{display:grid;grid-template-columns:220px 1fr;gap:18px;margin-top:14px}
.sidebar{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
.sidebar h4{margin:6px 0}
.categories button{display:block;width:100%;text-align:left;border:0;padding:8px;border-radius:8px;background:transparent;cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
.product{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04);display:flex;flex-direction:column;gap:8px}
.product img{width:100%;height:170px;object-fit:contain;border-radius:8px;background:#fff}
.product h3{margin:0;font-size:15px}
.price{font-weight:800;font-size:16px;color:#111}
.small{font-size:13px;color:var(--muted)}
.actions{display:flex;gap:8px;margin-top:auto}
.btn{background:var(--accent);color:#fff;padding:9px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
.btn.alt{background:#fff;color:var(--accent);border:1px solid #ddd}
.rightpanel{background:transparent}
.overlay{position:fixed;inset:0;background:rgba(3,6,12,0.5);display:none;align-items:center;justify-content:center;z-index:90}
.modal{width:920px;max-width:96%;background:#fff;border-radius:10px;padding:16px;display:flex;gap:12px;max-height:86vh;overflow:auto}
.detailImg{width:46%;background:#fafafa;padding:12px;border-radius:8px}
.detailInfo{width:54%;display:flex;flex-direction:column;gap:8px}
.qty{width:90px;padding:8px;border-radius:8px;border:1px solid #ddd}
.orderCard{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04);margin-top:12px}
.timeline{display:flex;gap:10px;align-items:center;margin-top:10px}
.step{flex:1;text-align:center}
.dot{width:14px;height:14px;border-radius:8px;margin:0 auto 6px auto;background:#eee}
.dot.done{background:var(--brand)}
.label{font-size:13px;color:var(--muted)}
.authBox{max-width:420px;margin:26px auto;background:#fff;padding:18px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.06)}
.profileBox{background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
.controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
@media(max-width:980px){
  .grid{grid-template-columns:repeat(2,1fr)}
  .layout{grid-template-columns:1fr}
  .hero{flex-direction:column}
}
@media(max-width:640px){
  header.navbar{flex-wrap:wrap}
  .search{order:3;width:100%}
  .navlinks{order:2;width:100%;justify-content:space-between}
  .grid{grid-template-columns:1fr}
  .modal{flex-direction:column}
}
.center{text-align:center}
.smallbtn{padding:6px 8px;border-radius:6px;border:1px solid #ddd;background:#fff;cursor:pointer}
.badge{background:var(--brand);color:#111;padding:6px 8px;border-radius:6px;font-weight:800}
.footer{max-width:1200px;margin:24px auto;padding:12px 16px;color:var(--muted);font-size:13px}
</style>
</head>
<body>

<header class="navbar">
  <a href="#" class="logo" onclick="goHome()"><span class="box">Shop</span><span style="color:#fff">Clone</span></a>
  <div class="search">
    <input id="searchInput" placeholder="Search products, brands and more..." oninput="renderProducts()" />
    <button onclick="renderProducts()">Search</button>
  </div>
  <div class="navlinks">
    <div class="item" id="navAccount" onclick="openAuth()">
      <div id="navHello">Hello, Guest</div>
      <div style="font-weight:700">Account & Lists</div>
    </div>
    <div class="item" onclick="openOrders()">Orders</div>
    <div class="item" onclick="openProfile()">Profile</div>
    <div class="item" onclick="openCartDisabled()">Cart <span class="badge" id="orderCount">0</span></div>
  </div>
</header>

<main class="container">
  <div class="topbar">
    <div class="hero">
      <div class="banner">
        <h2 style="margin:0">ShopClone â€” Amazon-style client-server demo</h2>
        <p class="small" style="margin:6px 0 0">No cart/checkout/address â€” direct buy (one-click place order). Orders have states and can be tracked from your profile.</p>
      </div>
    </div>
    <div class="rightpanel" style="width:280px">
      <div class="profileBox" id="miniProfile">
        <div style="display:flex;gap:10px;align-items:center">
          <div style="width:56px;height:56px;border-radius:8px;background:linear-gradient(90deg,var(--brand),#f1a400);display:flex;align-items:center;justify-content:center;font-weight:800;color:#111;font-size:20px" id="miniAv">G</div>
          <div>
            <div id="miniName" style="font-weight:800">Guest</div>
            <div class="small" id="miniEmail">Not logged in</div>
          </div>
        </div>
        <div style="height:10px"></div>
        <div style="display:flex;gap:8px">
          <button class="smallbtn" onclick="openAuth()">Login</button>
          <button class="smallbtn" onclick="openOrders()">My Orders</button>
        </div>
      </div>
      <div style="height:12px"></div>
      <div class="orderCard">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><div class="small">Orders</div><div style="font-weight:700" id="ordersSummary">0 orders</div></div>
          <div style="font-size:22px;color:var(--brand)">ðŸšš</div>
        </div>
        <p class="small" style="margin-top:8px">Place direct orders from product pages. Track their status on your profile.</p>
      </div>
    </div>
  </div>

  <div class="layout">
    <aside class="sidebar">
      <h4>Shop by Category</h4>
      <div class="categories">
        <button onclick="setCategory('all')">All</button>
        <button onclick="setCategory('electronics')">Electronics</button>
        <button onclick="setCategory('mobile')">Phones & Tablets</button>
        <button onclick="setCategory('audio')">Audio</button>
        <button onclick="setCategory('camera')">Cameras</button>
      </div>
      <div style="height:12px"></div>
      <div class="small">Demo user: <strong>demo@shopclone.test</strong> / <strong>demo123</strong></div>
      <div style="height:10px"></div>
      <button class="btn" onclick="openAuth('login')">Login / Signup</button>
    </aside>

    <section style="min-height:320px">
      <div class="controls">
        <div><strong id="resultTitle">Products</strong></div>
        <div class="small">Sort
          <select onchange="setSort(this.value)" id="sortSel">
            <option value="recommended">Recommended</option>
            <option value="price_asc">Price â†‘</option>
            <option value="price_desc">Price â†“</option>
            <option value="name">Name</option>
          </select>
        </div>
      </div>

      <div id="productGrid" class="grid"></div>
    </section>
  </div>
</main>

<!-- Product modal -->
<div id="productOverlay" class="overlay" onclick="closeOverlay(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="detailImg" id="detailImg"></div>
    <div class="detailInfo">
      <div style="display:flex;justify-content:space-between;align-items:start">
        <div>
          <h2 id="detailTitle" style="margin:0">Product</h2>
          <div class="small" id="detailBrand">Brand â€¢ Category</div>
        </div>
        <div style="text-align:right">
          <div class="price" id="detailPrice">â‚¹0</div>
          <div class="small" id="detailStock">In stock</div>
        </div>
      </div>

      <p class="small" id="detailDesc" style="margin-top:8px"></p>

      <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
        <input id="buyQty" class="qty" type="number" min="1" value="1" />
        <button class="btn" onclick="placeDirectOrder()">Buy Now</button>
        <button class="btn alt" onclick="addToWishlist()">Add to Wishlist</button>
      </div>

      <div style="height:8px"></div>
      <div class="small">Click "Buy Now" to place a direct order (no cart). Orders link will appear in your Profile / Orders list.</div>
    </div>
  </div>
</div>

<!-- Auth overlay -->
<div id="authOverlay" class="overlay" style="display:none;align-items:flex-start;padding-top:6vh" onclick="closeAuth(event)">
  <div class="authBox" onclick="event.stopPropagation()">
    <div id="authContent"></div>
    <div style="height:8px" class="small">Using localStorage for demo accounts. Demo: demo@shopclone.test / demo123</div>
  </div>
</div>

<!-- Orders overlay -->
<div id="ordersOverlay" class="overlay" style="display:none;align-items:flex-start;padding-top:6vh" onclick="closeOrders(event)">
  <div class="authBox" style="width:92%;max-width:900px" onclick="event.stopPropagation()">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0">Your Orders</h3>
      <div><button class="btn alt" onclick="closeOrders()">Close</button></div>
    </div>
    <div id="ordersList" style="margin-top:12px"></div>
  </div>
</div>

<!-- Profile overlay -->
<div id="profileOverlay" class="overlay" style="display:none;align-items:flex-start;padding-top:6vh" onclick="closeProfile(event)">
  <div class="authBox" style="width:92%;max-width:700px" onclick="event.stopPropagation()">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0">Profile</h3>
      <div>
        <button class="btn alt" onclick="logout()">Logout</button>
      </div>
    </div>
    <div style="margin-top:12px">
      <div style="display:flex;gap:12px;align-items:center">
        <div style="width:64px;height:64px;border-radius:8px;background:linear-gradient(90deg,var(--brand),#f1a400);display:flex;align-items:center;justify-content:center;font-weight:800;color:#111;font-size:20px" id="profileAvatar">G</div>
        <div>
          <div style="font-weight:800" id="profileName">Guest</div>
          <div class="small" id="profileEmail">Not logged in</div>
        </div>
      </div>

      <div style="height:12px"></div>
      <div>
        <label class="small">Edit Name</label>
        <input id="editName" style="padding:8px;border-radius:8px;border:1px solid #ddd;width:100%" />
        <div style="height:8px"></div>
        <button class="btn" onclick="saveProfile()">Save</button>
      </div>

      <div style="height:12px"></div>
      <h4>Your Orders</h4>
      <div id="profileOrders"></div>
    </div>
  </div>
</div>

<div class="footer">
  This is a demo application for educational/assignment purposes. It is inspired by typical e-commerce UIs but is an original implementation.
</div>

<script>
/* ================================
   Simulated Server (in-memory + persistence for demo)
   ================================ */
const Server = (function(){
  const products = [
    {id:201, name:"ASUS ROG Gaming Laptop", brand:"ASUS", category:"electronics", price:79999, stock:4, img:"https://images.unsplash.com/photo-1611078489396-4f0e458db30f?auto=format&fit=crop&w=900&q=80", desc:"High-performance gaming laptop with RTX graphics."},
    {id:202, name:"Apple iPhone 14 (128GB)", brand:"Apple", category:"mobile", price:63999, stock:6, img:"https://images.unsplash.com/photo-1563237028-0a0f9b3a5f1b?auto=format&fit=crop&w=900&q=80", desc:"Sleek design, powerful A-series chipset."},
    {id:203, name:"Sony WH-1000XM5 Headphones", brand:"Sony", category:"audio", price:24999, stock:8, img:"https://images.unsplash.com/photo-1518444020843-4f6b2f0d6f9a?auto=format&fit=crop&w=900&q=80", desc:"Industry-leading noise cancellation."},
    {id:204, name:"Canon EOS 200D DSLR", brand:"Canon", category:"camera", price:45999, stock:3, img:"https://images.unsplash.com/photo-1519183071298-a2962be54a5a?auto=format&fit=crop&w=900&q=80", desc:"Compact DSLR for beginners and enthusiasts."},
    {id:205, name:"Samsung Galaxy Tab S7", brand:"Samsung", category:"mobile", price:49999, stock:5, img:"https://images.unsplash.com/photo-1605110395942-9f32f1b77a0f?auto=format&fit=crop&w=900&q=80", desc:"10.4-inch tablet with excellent display."},
    {id:206, name:"JBL Flip 6 Speaker", brand:"JBL", category:"audio", price:6999, stock:10, img:"https://images.unsplash.com/photo-1599947420193-1a617a8b0d30?auto=format&fit=crop&w=900&q=80", desc:"Portable Bluetooth speaker with punchy bass."},
    {id:207, name:"Logitech Mechanical Keyboard", brand:"Logitech", category:"electronics", price:6999, stock:9, img:"https://images.unsplash.com/photo-1545239351-1141bd82e8a6?auto=format&fit=crop&w=900&q=80", desc:"Tactile mechanical switches, RGB lighting."},
    {id:208, name:"Mi 20000mAh Power Bank", brand:"Xiaomi", category:"electronics", price:2499, stock:20, img:"https://images.unsplash.com/photo-1591000075835-b7d3d1642c13?auto=format&fit=crop&w=900&q=80", desc:"High-capacity fast charging power bank."},
    {id:209, name:"Bose QuietComfort Earbuds", brand:"Bose", category:"audio", price:19999, stock:5, img:"https://images.unsplash.com/photo-1600180758890-3ad4a9c6fb47?auto=format&fit=crop&w=900&q=80", desc:"Comfortable earbuds with superb ANC."},
    {id:210, name:"Google Pixel 7a", brand:"Google", category:"mobile", price:34999, stock:7, img:"https://images.unsplash.com/photo-1613814006661-6f71b2f7b35d?auto=format&fit=crop&w=900&q=80", desc:"Clean Android experience and great camera."}
  ];

  // orders stored; persist to localStorage for demo across reloads
  const LS_ORDERS = 'shopclone_orders_v1';
  let orders = JSON.parse(localStorage.getItem(LS_ORDERS) || '[]');
  let nextOrderId = orders.reduce((m,o)=>Math.max(m,o.orderId),1000) + 1;

  function saveOrders(){ localStorage.setItem(LS_ORDERS, JSON.stringify(orders)) }

  function getProduct(id){ return products.find(p=>p.id==id) }
  function listProducts(){ return JSON.parse(JSON.stringify(products)) }
  function getOrdersFor(email){ return orders.filter(o=>o.userEmail==email).map(o=>JSON.parse(JSON.stringify(o))) }
  function getOrderById(id){ return JSON.parse(JSON.stringify(orders.find(o=>o.orderId==id))) }

  function placeOrder(userEmail, items){
    // items: [{id, qty}]
    for (let it of items){
      const p = getProduct(it.id);
      if (!p) return {error:'Product not found: '+it.id};
      if (p.stock < it.qty) return {error:'Not enough stock for '+p.name};
    }
    // decrement stock (simulate DB update)
    for (let it of items){
      const p = getProduct(it.id);
      p.stock -= it.qty;
    }
    const total = items.reduce((s,it)=> s + getProduct(it.id).price * it.qty, 0);
    const order = { orderId: nextOrderId++, userEmail, items:JSON.parse(JSON.stringify(items)), total, status:'Processing', createdAt: new Date().toISOString() };
    orders.push(order); saveOrders();
    return JSON.parse(JSON.stringify(order));
  }

  function advanceStatus(orderId){
    const o = orders.find(x=>x.orderId==orderId);
    if (!o) return;
    const states = ['Processing','Shipped','Out for Delivery','Delivered'];
    const idx = states.indexOf(o.status);
    if (idx < states.length-1){ o.status = states[idx+1]; saveOrders(); }
  }

  return { listProducts, getProduct, placeOrder, getOrdersFor, getOrderById, advanceStatus }
})();

/* ============================
   App (UI + session handling)
   ============================ */
const App = (function(){
  const LS_USERS = 'shopclone_users_v1';
  const LS_SESSION = 'shopclone_session_v1';

  function loadUsers(){ try { return JSON.parse(localStorage.getItem(LS_USERS) || '[]') } catch(e){ return [] } }
  function saveUsers(u){ localStorage.setItem(LS_USERS, JSON.stringify(u)) }
  function getSession(){ try { return JSON.parse(localStorage.getItem(LS_SESSION) || 'null') } catch(e){ return null } }
  function saveSession(s){ localStorage.setItem(LS_SESSION, JSON.stringify(s)) }
  function clearSession(){ localStorage.removeItem(LS_SESSION) }

  // ensure demo user
  (function ensureDemo(){
    const users = loadUsers();
    if (!users.find(u=>u.email=='demo@shopclone.test')){
      users.push({name:'Demo User', email:'demo@shopclone.test', password:'demo123'});
      saveUsers(users);
    }
  })();

  function currentUser(){ const s = getSession(); if (!s) return null; const u = loadUsers().find(x=>x.email==s.email); return u || null }

  function updateHeader(){
    const u = currentUser();
    const hello = document.getElementById('navHello');
    const miniName = document.getElementById('miniName');
    const miniEmail = document.getElementById('miniEmail');
    const miniAv = document.getElementById('miniAv');
    if (!u){ hello.innerText = 'Hello, Guest'; miniName.innerText = 'Guest'; miniEmail.innerText = 'Not logged in'; miniAv.innerText = 'G'; return; }
    hello.innerText = 'Hi, '+ (u.name.split(' ')[0] || u.name);
    miniName.innerText = u.name; miniEmail.innerText = u.email; miniAv.innerText = u.name[0].toUpperCase();
    document.getElementById('profileName').innerText = u.name;
    document.getElementById('profileEmail').innerText = u.email;
    document.getElementById('profileAvatar').innerText = u.name[0].toUpperCase();
  }

  function showAuth(mode='login', message=''){
    const el = document.getElementById('authContent');
    if (mode==='login'){
      el.innerHTML = `
        <div style="display:flex;gap:10px;align-items:center">
          <div style="width:56px;height:56px;background:linear-gradient(90deg,var(--brand),#f1a400);display:flex;align-items:center;justify-content:center;font-weight:800;color:#111;font-size:20px">U</div>
          <div><div style="font-weight:800">Sign in</div><div class="small">${message}</div></div>
        </div>
        <div style="height:10px"></div>
        <label class="small">Email</label><input id="authEmail" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd" />
        <label class="small">Password</label><input id="authPass" type="password" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd" />
        <div style="height:8px"></div>
        <div style="display:flex;gap:8px">
          <button class="btn" onclick="App.login()">Sign in</button>
          <button class="btn alt" onclick="App.showSignup()">Create account</button>
        </div>
      `;
    } else {
      el.innerHTML = `
        <div style="display:flex;gap:10px;align-items:center">
          <div style="width:56px;height:56px;background:linear-gradient(90deg,var(--brand),#f1a400);display:flex;align-items:center;justify-content:center;font-weight:800;color:#111;font-size:20px">U</div>
          <div><div style="font-weight:800">Create account</div><div class="small">Quick demo account</div></div>
        </div>
        <div style="height:10px"></div>
        <label class="small">Full name</label><input id="authName" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd" />
        <label class="small">Email</label><input id="authEmail" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd" />
        <label class="small">Password</label><input id="authPass" type="password" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd" />
        <div style="height:8px"></div>
        <div style="display:flex;gap:8px">
          <button class="btn" onclick="App.signup()">Create</button>
          <button class="btn alt" onclick="App.showLogin()">Back to login</button>
        </div>
      `;
    }
    document.getElementById('authOverlay').style.display='flex';
  }

  function closeAuth(){ document.getElementById('authOverlay').style.display='none' }

  function login(){
    const email = document.getElementById('authEmail').value.trim();
    const pass = document.getElementById('authPass').value;
    const users = loadUsers();
    const u = users.find(x=>x.email==email && x.password==pass);
    if (!u) return alert('Invalid credentials');
    saveSession({email:u.email});
    closeAuth(); updateHeader(); showToast('Logged in');
  }

  function signup(){
    const name = document.getElementById('authName').value.trim();
    const email = document.getElementById('authEmail').value.trim();
    const pass = document.getElementById('authPass').value;
    if (!name || !email || !pass) return alert('Fill all fields');
    const users = loadUsers();
    if (users.find(x=>x.email==email)) return alert('Email already registered');
    users.push({name,email,password:pass});
    saveUsers(users);
    saveSession({email});
    closeAuth(); updateHeader(); showToast('Account created & logged in');
  }

  function logout(){ clearSession(); updateHeader(); showToast('Logged out'); closeProfile(); closeOrders(); }

  // rendering products
  let currentCategory = 'all';
  let sortMode = 'recommended';
  function setCategory(c){ currentCategory = c; renderProducts() }
  function setSort(s){ sortMode = s; renderProducts() }

  function renderProducts(){
    const q = document.getElementById('searchInput').value.trim().toLowerCase();
    let items = Server.listProducts();
    if (currentCategory !== 'all') items = items.filter(p=>p.category==currentCategory);
    if (q) items = items.filter(p => (p.name + ' ' + p.brand + ' ' + p.desc).toLowerCase().includes(q));
    if (sortMode === 'price_asc') items.sort((a,b)=>a.price-b.price);
    if (sortMode === 'price_desc') items.sort((a,b)=>b.price-a.price);
    if (sortMode === 'name') items.sort((a,b)=>a.name.localeCompare(b.name));
    const grid = document.getElementById('productGrid');
    grid.innerHTML = items.map(p=>`
      <div class="product" data-id="${p.id}">
        <img src="${p.img}" alt="${p.name}" onclick="App.openProduct(${p.id})"/>
        <h3 onclick="App.openProduct(${p.id})">${p.name}</h3>
        <div class="small">${p.brand} â€¢ ${p.category}</div>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="price">â‚¹${p.price.toLocaleString()}</div>
            <div class="small">Stock: ${p.stock}</div>
          </div>
          <div style="width:120px">
            <button class="btn" onclick="App.openProduct(${p.id})">View</button>
            <button class="btn alt" onclick="App.quickBuy(${p.id})" style="margin-top:6px">Buy</button>
          </div>
        </div>
      </div>
    `).join('');
    document.getElementById('resultTitle').innerText = `${items.length} products`;
    updateOrdersSummary();
  }

  function openProduct(id){
    const p = Server.getProduct(id);
    if (!p) return alert('Product not found');
    document.getElementById('productOverlay').style.display='flex';
    document.getElementById('detailImg').innerHTML = `<img src="${p.img}" style="width:100%;border-radius:8px;object-fit:contain"/>`;
    document.getElementById('detailTitle').innerText = p.name;
    document.getElementById('detailBrand').innerText = `${p.brand} â€¢ ${p.category}`;
    document.getElementById('detailPrice').innerText = 'â‚¹' + p.price.toLocaleString();
    document.getElementById('detailStock').innerText = `Stock: ${p.stock}`;
    document.getElementById('detailDesc').innerText = p.desc;
    document.getElementById('buyQty').value = 1;
    document.getElementById('productOverlay').dataset.pid = id;
  }

  function closeOverlay(e){ if (e.target.id === 'productOverlay') document.getElementById('productOverlay').style.display='none' }

  // direct one-click buy (no cart)
  function placeDirectOrder(){
    const uid = getCurrentUserEmail();
    if (!uid){ showAuth('login','Login to place orders'); return; }
    const pid = Number(document.getElementById('productOverlay').dataset.pid);
    const qty = Math.max(1, Number(document.getElementById('buyQty').value) || 1);
    const res = Server.placeOrder(uid, [{id:pid, qty}]);
    if (res.error) return alert(res.error);
    document.getElementById('productOverlay').style.display='none';
    showToast('Order placed! Order ID: ' + res.orderId);
    // open orders so user can view it
    openOrders();
    renderProducts();
  }

  // quick buy from grid (bypasses modal)
  function quickBuy(id){
    const qty = 1;
    const uid = getCurrentUserEmail();
    if (!uid){ showAuth('login','Login to place orders'); return; }
    const res = Server.placeOrder(uid, [{id, qty}]);
    if (res.error) return alert(res.error);
    showToast('Order placed! Order ID: ' + res.orderId);
    openOrders();
    renderProducts();
  }

  // orders UI
  function openOrders(){
    const u = currentUser();
    if (!u){ showAuth('login','Login to view your orders'); return; }
    const list = document.getElementById('ordersList');
    const orders = Server.getOrdersFor(u.email);
    if (!orders.length){ list.innerHTML = '<div class="small center">You have no orders yet</div>'; document.getElementById('ordersOverlay').style.display='flex'; return; }
    list.innerHTML = orders.map(renderOrderCard).join('');
    document.getElementById('ordersOverlay').style.display='flex';
  }
  function closeOrders(e){ if (!e || e.target.id==='ordersOverlay') document.getElementById('ordersOverlay').style.display='none' }

  function renderOrderCard(o){
    const itemsHTML = o.items.map(it=>{
      const p = Server.getProduct(it.id);
      return `<div style="display:flex;gap:10px;align-items:center;padding:8px 0;border-bottom:1px dashed #eee">
        <img src="${p.img}" style="width:64px;height:64px;object-fit:contain;border-radius:8px"/>
        <div style="flex:1">
          <div style="font-weight:700">${p.name}</div>
          <div class="small">Qty: ${it.qty} â€¢ â‚¹${(p.price*it.qty).toLocaleString()}</div>
        </div>
      </div>`;
    }).join('');
    const states = ['Processing','Shipped','Out for Delivery','Delivered'];
    const idx = states.indexOf(o.status);
    const timeline = states.map((s,i)=>`<div class="step"><div class="dot ${i<=idx?'done':''}"></div><div class="label">${s}</div></div>`).join('');
    return `<div class="orderCard">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>Order #${o.orderId}</strong><div class="small">Placed: ${new Date(o.createdAt).toLocaleString()}</div></div>
        <div><strong>â‚¹${o.total.toLocaleString()}</strong></div>
      </div>
      <div style="margin-top:10px">${itemsHTML}</div>
      <div class="timeline">${timeline}</div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
        <div class="small">Status: <strong>${o.status}</strong></div>
        <div style="display:flex;gap:8px">
          <button class="btn alt" onclick="App.track(${o.orderId})">Track</button>
          <button class="btn" onclick="App.simulate(${o.orderId})">Simulate Progress</button>
        </div>
      </div>
    </div>`;
  }

  // track â€” advances status on every track (per your choice). Also opens orders overlay to show timeline.
  function track(orderId){
    // advance status each time user tracks (demo)
    Server.advanceStatus(orderId);
    openOrders();
    showToast('Order status updated (simulated server)');
  }

  // simulate progress (manual)
  function simulate(orderId){
    Server.advanceStatus(orderId);
    openOrders();
    renderProducts();
    showToast('Server advanced order state for demo');
  }

  // profile view
  function openProfile(){
    const u = currentUser();
    if (!u){ showAuth('login','Login to access profile'); return; }
    document.getElementById('profileOverlay').style.display='flex';
    document.getElementById('editName').value = u.name;
    renderProfileOrders();
  }
  function closeProfile(e){ if (!e || e.target.id==='profileOverlay') document.getElementById('profileOverlay').style.display='none' }

  function renderProfileOrders(){
    const u = currentUser();
    if (!u) return;
    const orders = Server.getOrdersFor(u.email);
    document.getElementById('profileOrders').innerHTML = orders.length ? orders.map(o=>`<div style="margin-top:10px">${renderSmallOrder(o)}</div>`).join('') : '<div class="small center">No orders yet</div>';
    document.getElementById('ordersSummary').innerText = `${orders.length} orders`;
  }
  function renderSmallOrder(o){
    const states = ['Processing','Shipped','Out for Delivery','Delivered'];
    const idx = states.indexOf(o.status);
    const timeline = states.map((s,i)=>`<div class="step"><div class="dot ${i<=idx?'done':''}"></div><div class="label">${s}</div></div>`).join('');
    return `<div class="orderCard">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>Order #${o.orderId}</strong><div class="small">Placed: ${new Date(o.createdAt).toLocaleString()}</div></div>
        <div><strong>â‚¹${o.total.toLocaleString()}</strong></div>
      </div>
      <div style="margin-top:8px" class="small">Status: <strong>${o.status}</strong></div>
      <div class="timeline" style="margin-top:8px">${timeline}</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn alt" onclick="App.track(${o.orderId})">Track</button>
        <button class="btn" onclick="App.simulate(${o.orderId})">Simulate Progress</button>
      </div>
    </div>`;
  }

  function saveProfile(){
    const u = currentUser();
    if (!u) return alert('Not logged in');
    const newName = document.getElementById('editName').value.trim();
    if (!newName) return alert('Name cannot be empty');
    const users = loadUsers();
    const idx = users.findIndex(x=>x.email==u.email); users[idx].name = newName; saveUsers(users);
    updateHeader(); showToast('Profile saved');
    renderProfileOrders();
  }

  function getCurrentUserEmail(){ const s = getSession(); return s ? s.email : null }

  function updateOrdersSummary(){
    const u = currentUser();
    if (!u){ document.getElementById('ordersSummary').innerText = '0 orders'; document.getElementById('orderCount').innerText = '0'; return; }
    const orders = Server.getOrdersFor(u.email);
    document.getElementById('ordersSummary').innerText = `${orders.length} orders`;
    document.getElementById('orderCount').innerText = `${orders.length}`;
    document.getElementById('miniName').innerText = u.name;
  }

  // small helpers
  function showToast(msg, t=1600){
    const d = document.createElement('div'); d.style.position='fixed'; d.style.right='18px'; d.style.bottom='18px'; d.style.background='rgba(0,0,0,0.8)'; d.style.color='#fff'; d.style.padding='10px 14px'; d.style.borderRadius='10px'; d.style.zIndex=200; d.style.fontWeight=700; d.innerText = msg; document.body.appendChild(d);
    setTimeout(()=>{ d.style.transition='200ms'; d.style.opacity=0; setTimeout(()=>d.remove(),240) }, t);
  }

  // exposed API
  return {
    init(){
      renderProducts();
      updateHeader();
      updateOrdersSummary();
    },
    openProduct(id){ openProduct(id) },
    quickBuy(id){ quickBuy(id) },
    placeDirectOrder(){ placeDirectOrder() },
    showAuth(mode,msg){ showAuth(mode,msg) },
    login(){ login() },
    signup(){ signup() },
    showSignup(){ showAuth('signup') },
    showLogin(){ showAuth('login') },
    logout(){ logout() },
    openOrders(){ openOrders() },
    track(orderId){ track(orderId) },
    simulate(orderId){ simulate(orderId) },
    openProfile(){ openProfile() },
    saveProfile(){ saveProfile() }
  }
})();

/* make selected functions available globally to use inside inline onclicks */
window.App = {
  openProduct: (id)=>App.openProduct(id),
  quickBuy: (id)=>App.quickBuy(id),
  track: (id)=>App.track(id),
  simulate: (id)=>App.simulate(id),
  openOrders: ()=>App.openOrders(),
  openProfile: ()=>App.openProfile(),
  showAuth: (m,txt)=>App.showAuth(m,txt),
  signup: ()=>App.signup(),
  login: ()=>App.login(),
  logout: ()=>App.logout(),
  saveProfile: ()=>App.saveProfile(),
  placeDirectOrder: ()=>App.placeDirectOrder(),
  init: ()=>App.init()
};

/* helpers used by HTML */
function goHome(){ App.init(); document.getElementById('productOverlay').style.display='none'; document.getElementById('authOverlay').style.display='none'; document.getElementById('ordersOverlay').style.display='none'; document.getElementById('profileOverlay').style.display='none'; window.scrollTo({top:0,behavior:'smooth'}); }
function setCategory(c){ App.setCategory ? App.setCategory(c) : null; /* uses closure above */ }
function setSort(v){ App.setSort ? App.setSort(v) : null; }

/* overlay close wrappers */
function closeAuth(e){ if (e.target.id==='authOverlay') document.getElementById('authOverlay').style.display='none' }
function closeOrders(e){ if (e.target.id==='ordersOverlay') document.getElementById('ordersOverlay').style.display='none' }
function closeProfile(e){ if (e.target.id==='profileOverlay') document.getElementById('profileOverlay').style.display='none' }

/* run init */
App.init();

/* wire buttons not exposed above */
document.getElementById('authOverlay').addEventListener('click', ()=>document.getElementById('authOverlay').style.display='none');

document.getElementById('profileOverlay').addEventListener('click', ()=>document.getElementById('profileOverlay').style.display='none');

/* expose internal functions for saving profile from inline button */
function saveProfile(){ App.saveProfile(); }

/* small utilities for inline use (buy now, wishlist) */
function placeDirectOrder(){ App.placeDirectOrder(); }
function addToWishlist(){ showToast('Added to wishlist (demo)'); }

/* Note: Because of single-file simulation, server-side persistence is limited:
   - Users are stored in localStorage (demo accounts)
   - Orders are stored in localStorage (so they survive reloads)
   - Product stock is kept in-memory for the session but modified when orders placed (persisted via orders load on refresh)
*/

/* End of file */
</script>
</body>
</html>
